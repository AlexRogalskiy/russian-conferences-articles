**Здесь переводится видео в статью Александра Сигачева из Inventos "Процесс разработки и тестирования с Docker + Gitlab CI"**

Ссылка на видеодоклад https://www.youtube.com/watch?v=lJsqRwULRVA

**Текст сделан из субтитров. Буду очень благодарен в форматировании текста, его вычитки. Для этого достаточно знать русский язык.
Присылайте свои pull request или присылайте текст на почту patsev.anton[собака]gmail.com**

Меня зовут Александр Сигачев расскажу о своем опыте использования docker и о том как мы компании процесса разработки сколько стиле вскоре номер и club и соответственно и джобса 

о чем на плату это второй мой доклад продуктов первый доклад был примерно полгода назад в тот момент мы использовали докер только белла панти машинах задара бочеков количество сотрудников которые приняли это было 23 человека постепенно был накоплен опыт за полгода мы немного продвинулись дальше наши разработки 

цепочка здесь приведена как раз на первый наш на слайдах 

что будет поздно докладе мы поделимся опытом о том какие игровые собрали какие проблемы как решили не везде это было морга делом красивого но покормили позволю бьется дальше 

ну и соответственно здесь на дакаре зиру и все да чё так вот наши руки 

какие проблемы решаем когда команде в компании несколько команд то провести являются жареным ли солнцем и соответственно бывают этапы когда программистов идет создал проект и дают на какое-то время другая это

 чтобы promise быстро вошел ему необходимо скачать соответственно сколько код проекта и как можно быстрее запустить среду который позволит ему даже подвигаться решая эти это задачи данного проекта

 обычно если начинаешь снаряд the documentation проектом ведется мало как настроить есть только у старожилов и самостоятельно на сатурне настраивать свое окружающие устает рабочие места за день-два

 чтобы это ускорить мы применили докер

 следующая причина которых убить побудило это стандартизации настрой удивил опыте 

по моему опыту разработчики всегда проявляют инициативу вы в частности где-то в случае в 1 из 5 каждый волен свой какой-то кастомными допустим счастья . рядом сидит сосед питья . и разрабатывает сайт или какой-то компонент системы используя то доменное имя 

тогда система разрастается и идти доменами на начинаю попадай конфигурации то возникает конфликт окружении в том что друг другу конфликтуют и переписываю путь до допустим и сайта 

то же самое происходит с настройками базы данных потому что кто-то не заморочиться безопасности работали труда , паролем у кого-то на этапе установки мы скорее все-таки потребовал пароли и пароль оказался один два три и тоже часто случались картина когда конфликт базе данных постоянно менялся зависимость от кроме травой и кто тогда был поправить поправил были ухищрения когда мы выносили какой-то тестовый конфликт это вино и каждый рабочий должен был составить базу данных усложняло процесс потому что нужно было кроме всего прочего помнить что сеть базе данных базу данных таблицы визировать надо прописать пароль надо прописать пользуюсь тебя создать табличку и так далее 

еще одна из проблем это разные версии библиотек так как так часто бывает что в работы с разными сколько проектов есть двигать проект который начинают пять лет назад и момент старта men's создавались бы смысл допустим 5 5 так и современные проекты мы стараемся внедрять уже более современные то допустим 570 стаж у нас это 57 

соответственно кто-то распускает знали что эти библиотеки термостат зависимости где достаточно проблематично запустить разные месте и по крайне мере старые клиенты новый борьба это порождает свою очередь несколько проблем 

следующий проблема это когда разработчики работу на локальной машине он носит категории в локальных ресурсов то есть у нее есть локальные файлы есть локальное озу и все взаимодействие на момент разработки решение задач выполняется в рамках того что это работает на одной машине пример может служить когда у нас продакшн и допустим 3 в кендо а разработчик не задумывались сделать сохранение файлов какой-то лох и я тоже отдаю того то есть кадр попадает production получается что файл и собственно полностью солировать перед он вызывает проблемы которые небольшая много существует

 также это модно сейчас направлений микро сервиса когда мы большие наши приложения делим на какие-то маленькие компоненты взаимодействующие между собой что это позволяет это позволяет под конкретный стык задачами по следует выбрать технологии а также наш компании мы практикуем на ног проекторов это позволяет разделить работу и зона ответственности разработчиками то есть контейнер допустим разрабатывая на джесси практически не влияет на пкм бы kinder свою очередь разрабатываем в нашем случае руби у нравилось не мешает по контуру взаимодействие полнят по при помощи и хотя

 я уже это как бонус при помощи докер нам удалось утилизирует утилизировать ресурсы на стыке то есть изначально была проблема что каждый проект в силу своей специфики требовал определенные настройки физические нужно было выделять либо по виртуальному серверу и отдельных настраивать либо же 9 какой-то пример окружение и проект могли в зависимости от версии так для тех лет а другой

 инструмент и что мы используем это непосредственно сам докер внутрь файл в котором описывается зависимости для одного приложения только компост это является связка который объединяет самые несколько наших до к резервным приложений vitlab мы используем для хранения исходного кода гид ловца и мы используем для системной интеграции

 принципе слайды все будут доступны hansa pinto ственных 

доклад наш то есть это был их день адекватно состоит из двух частей

 первая часть она самая большая в этом докладе расскажет о том карпов мариновали машину шатра бочеков

 вторая часть рассказа о том как непосредственно взаимодействует с дипломом каждый пузырь тесты и как бы это заставляем на тренинг

для тех кто никогда не работал с докером и прими рисуешь эта технология которая позволяет используя класс данный подход описать необходимый компонент то есть это пример урезанный пример декор файла который тем не менее является рабочим 

здесь мы объявляем что мы наследуем ся от другого докер-контейнер который собран это официальный контейнер который поддерживал убей 

он уже содержит себе установлены другие версии 2 3 далее мы доставляем необходимы нам библиотеки

 в частности газики с горки минут для того чтобы ноги кружит приложения описываем что создаем какой-то каталог там тучи pp назначаемых от рабочей директории вот каталог помещаем необходимый минимальный game файл и тепло затем выполняем сборку непосредственно проектов которые тоже с собой стягивать этот образ зависимости и говорим что будем слушать что контейнер будет готов слушать на внешнем под утопична и последний команды это команда который непосредственно пускает наше приложение

 если мы выполним команду запуска проекта то приложи попробовать выполнится и запустить the peace ниже команда 

это при минимальными пример кампос пальма данном случае мы показываем что присходит связь двух приложений двух контейнеров это непосредственно в сервис баз данных и сервис в то есть нашего приложения больше всех своих случаи требуют качестве букин дыханием данных какую-то базу данных 

так как мы используем ускорить эту пример - но ничто не мешает сколько какой-то другу базу данных по адресам глэдис кто что использует своих работах 

соответственно мы берем из официального источника разбит в docker hub образом 57.14 без изменения 

образ который отвечает за нашего приложения buildings текущей директории

 то есть он во время запуска либо же при специальной команде которая говорит что он собрать собирает нам образа после чего запускает команду которую мы здесь выполняем

 если мы вернёмся назад то увидим что было предано команда запуска через пуму

 сервис написанным на то во втором случае мы переопределяем от команды может быть без производит зависимости от потребности ли задачи 

также мы описываем что нужно пробросить порт на наш эпос машине разработчиков 2000 на 2000 год контейнера 

ведь выполняется автоматически при помощи details of и свой механизм который непосредственно наложено вдоль киля и 

разработчик может также как и ранее обратиться на любой доступный порт усть не порта и печник допустим 127 локальный ли вы же какой-то из локальной сети или внешний зимой собственно машина и 

последняя строчка говорит что контейнер вот зависит от контейнера д.б. 

то есть когда мы вызываем запуск контейнера в предварительно докер apple запустит нам в аду тонах уже по старту база данных запустить нам приложение наш букет 

это позволяет избежать ошибок когда базы данных не поднята и позволяет экономить ресурсы когда мы останавливаем контейнер то баз данных пускается хаббарда этим сам ресурсы под другие проекты по другим а 

что нам даёт использовать у меня легализации базы данных на проекте мы все разработчики фиксируем версии мышку или

это позволяет избежать некоторых ошибок которые могут владик расхождение версий когда меняется какой-то синтаксис либо и конфигурация меняется какие-то дефолтные настройки

 это позволяет нам уже непосредственно указать какой вкусным для вас тонах мой логин пазлов использует у всех разработчику 

то есть мы выходим того зоопарка имен и конфликт в кафе файлов которые были на стороне мы 

как и сказал что мы уже имеем возможность плавать как это более оптимальный кантри для тела концерты который будет отличаться от дефолтного

 устроен достаточно на слабо машины соответственно предводитель нас будет значительно ниже

 нам позволяет уже ставить непосредственно наш интерпретатор питона но jest все что угодно нужной версии как системной

 мы избавляемся необходимости использовать какой-то менеджер версии 

то есть раньше как один способ это был допустим для грм пакет который позволяло менять версию зависимости от проекта

 также позволяет нам подарят вам итоге контейнер уже плавно мигрировать код и versante вместе зависимостями 

то есть у нас не возникает проблема понять версию как интерпретаторы так рикона лишний раз и будет это допустить старый контейнер и понятного тренер

 есть что пошли так мы можем опустить но контейнер поднять старый контейнер и

 результат букету контейнера как диалог не так важно не будет или ногой

 это особо актуально для больших к инсталляций ну принципе 10 9 потому что рассказ докладчики это более 20 серверов данный пак эндер то в одной ситуация во время тепло и отменяются репозитарий и на сервер остался на разные версии проложить

 на стенде инфанты и мы используем для разработки говорил java скрипты и но джесс

 сейчас у последнего этапа реакции соответственно работающий фронтэнда запускалась все контейнер и уже полив оплот не разрабатывал 

далее запускаю задачи по сборке воспитанники для клиента отдается уже через собранных статику экономя ресурсы и доставляем парень 



здесь я приехал схему нашего последний проект а то есть какие то значит у нас владимир необходимость построить систему карту из которых зима несет мобильные устройства они получают какие-то там данные список данных и 1 и 2 возрасте это послать push-уведомления в данное устройство в том и для этого сделали мы разделили на предложение многие компоненты как админской а часть на джесси backend которая работает брест через интерфейс подробном бубен заманить базы данных результат который генерация даются клиенту 

админка звуками нам из банданы соответственно заманить тоже по здесь

также у нас была необходимость отправлять уведомления и 

до этого у нас был проект которому же вылов было реализовывать было лизун механизм который отвечает за доставку уведомлений мобильных на мобильных платформах 

соответственно мы раздавали такую схему то есть оператор из браузера дик моррис админка admins модификантов ставится задача что надо позвать изготовления

 кусудам лейте соответствие взаимодействовать с другим компонент который реализован на ноги джесс

 соответственно строится в очереди и дальше идет к своему механизму а просто 

здесь нарисованы для вас данных текущий момент у нас при помощи докером и как 2 независимым посланы которые никак не связаны с собой и кроме того что у них это общая виртуальная сеть физические данные хранятся в разных каталог на наши лекторы чекам



 тоже самое ну в букв как здесь вам для ангела перри использование кода 

если ранее мы говорим про переиспользовать кода в виде библиотек отключали отдавали тонны данном примере наш сервис который отвечает затвор сообщение перри используется как полосу всех он предоставляет а ты здесь уже нашим новая разработка 

соответственно здесь по версии можно увидеть что работа сервера вов там полтора 

на тот момент было актуально но туристический сейчас все же разработки мы уже используем 7 долл 

то есть нет проблем новый компонент и не привлекать новый новые версии библиотек и компонент между собой дано действует 

при необходимости при может вывести будет рефакторинг и поднять версию допустим медленно вдоволь пуху сервис 

а если мы сможем сохранить свою с ним 25 то можно будет заменить именных проект которые используются ранее



 что надо чтобы добавить соответственно непосредственно кладем в нашей базе таре или файл который описывает необходимости необходимо зависимости 

данный пример предел для рисовой части то есть как говорю компоненты разбиты по логике и это минимальный набор она выгодна .

 то есть у нас получается новый проект него объемностью дают игр файл описываем безопасным они мои любимые системы кампус пальмы офису необходимы зависимость базы данных

 то есть мы там записываю что нужна база давно в этой версии хранить данные там титан то 

так же мы используем для дачи статике это отдельный 3 контейнер 

здесь получается есть возможность загрузки картинок 

backend кладет какой-то за обедом заранее подготовили том 1 x монтировала нас один тон для отдачи статике 

чтобы хранить операцию begin x и вообще чего-то мы добавили папку докер которых они необходимы и детям посредстве на уже в репозитарии 

когда разработчик делает plore представить себе на машину соответственно у него получается уже проект готовый для локальной разработки 

не вникает вопрос как вы пор протянуть 0 таким это это применить 

далее как его вел вас есть не компонента то есть компонент анны есть компонент информировать и есть push-уведомления

 для того чтобы это все пустить мы создали через бритой которые назвали коридоры момент мы используем не только считали до каждого компонента и они просто логически отличаются от вид лобби это как папочка по адресу а на машине разработчика довольство аптека под проект на уровень ниже для компонент которые будут объединяться 



и соответственно это пример как раз содержимого ударов нашего мы также выносим сюда только каталог в котором наполняем компьютер непосредственно требуемые для взаимодействий всех компонентов есть лет некоторым кратко описано как видим поиск отпускать 105 такая начальная информация

 здесь хоть и smart на файлике 

и здесь мы применили увидел что два компот файлы из просто который использует по умолчанию яму 

и есть компост я это сделал для того чтобы иметь возможность опускать ступенчато

 только до разработчика работать с ядром ему не уже душ уведомления то запуская просто кампус файл и соответственно ресурс экономится 

если необходимость интеграции скушали нам это запускать за игрой и запускается с отдельным пунктом 

так как хоть и файлики лежат под у папочки то автоматически каково создает виртуальную сеть средних остальные едино 



в сани компоненту это более расширенный файлик которая отвечает за сбор компонентов что здесь примечательно здесь мы валим компаний как балансира

 это готовый докер-образ отвечающие это то что запускай связанных с их приложение которое слушает dapper socket и динамические по мере включения включения контейнеров перегнили контентом фига джон икса и переводит обращение с компоненты мы разносим по доменным именам третьего уровня

 для дипломных среды мы ввели такое понятие что допустимо педи флобера так надо ли проекта рады в это просто показывает того что домен доступен на локальной машине разработчика 

дальше как мы уже видел души сайтов передаться конфликт до каждого проекта

 и запускается все это вместе с копом



есть и графический то получается клиент это наш браузер или какой-то инструмент которым мы осуществляем доброты посредстве на нашем балансе ru

 балансира по доменному имени определяет какому кантерлота pd обратиться 

то есть это может быть ужин из которой дают же салфетки это может быть должны с которой один отдает наша чай или же статические файлы которые отдают тирексом пить и загрузки картинок

 с кими видно что контейнера объединены виртуальную сеть и скрыты за прокси

 и можно обратиться на машине разработчика зная печник но мы принципе это не применять 

прямого обращения практически не возникает необходимость



 тему какой пример посмотреть чтобы корзину свои приложения на мой взгляд хорошим примером является официальной только образы для mais quel 

а он достаточно сложной там много версий но его функционал позволяет покрыть множество потребность которые могут одним то в процессе дальнейшего заработать то есть ему падать времени разберете к все это взаимодействует то я думаю самостоятельному внедрение у вас проблем не возникнет 

соответственно ссылочка на докера 

там есть сошки напитков где приведены непосредственно сырые данные из которых может самостоятельно собрать образа 

кроме того эти образы как здесь мы смотрим то есть 

мы обращаемся сделал для добьешься москве 57 это образ из бесплатного докер хранилище которое доступно публично 

то есть скачивается он не связан машины разработчика просто скачиваете средства и 

дальше по деталей пыль и скрип доки который отвечает за первичную утилизации видит дальнейшую обработку запуска приложения 

также в этом примере присутствует возможность эфиров при помощи переменного окружения 

то есть определяет переменное окружение при запуске одиночку контейнерами личный других акос можно сказать что нам нужно задать пустопорожняя доке на для рута на мышку или либо же какой то который мы хотим 

есть вариант создать подобный пароль мы варим что нам требуется пользователь требуется используйте пароль и требуется создать базу данных 

свои проекты официр овале докер который изучает за консультацию 

и там мы поправить по свои нужды сделать просто расширение прав пользователя которую использует приложение 

этапа угольном дальнейшем просто средствами нарисованы создать болтам концерте непосредственно приложение плела 

в приложениях есть команд создания изменения и удаления баз данных посредством по названию есть 



этот пример того как увели конкретно версия миску или а на гитхабе как рассудок и файл если вы открыть может посмотреть какие там пакеты как устанавливать какая техника используются 

и что интересно на эту отвечающую риза 

при первичной утилизации межбровье требуются некоторые действия по подготовке и все эти действия вынесены как раз скрипты реляции 



на этом первый час наш закончилась мы переходим ко второй части картера ним нас для хранения славных которым мы перешли на github 

это достаточно мощная система который имеет визуальный интерфейс и позволяет делать кучу внутренней работы просто 

один компонент дуги club agreed with love царь он позволяет описывать последовать команд которые впоследствии будет использовать того чтобы еда систему доставки кота или запуска автоматического тестирования 

2 ссылочки это как раз да классно guitar царь там доклад с руби код по моему достаточно подробный не важно 2 заинтересует и 

2 ссылочка на область насер которую мы используем компании достаточно стабильный дешевые для личных проектов 



сейчас мы с вами рассмотрим что требуется для того чтобы активируете словца и того чтобы запустить apple официально достаточно вскоре проекта положить файлик и мы 

здесь мы описываем что мы хотим последование состоянии типа тест деплоя 

далее мы описываем как достояние что не в состоянии

 выполняем скрипты которые вызывают непосредственно доки компост сборку нашего приложения например я как раз бэг-энда 

и далее мы говорим что необходимо правильно операции база данных и выполнить тест а 

если скрип выполнялись корректный не возвращает код ошибки то соответственно то даже пианино сне то соответственно система переходит ко второй стадии станет тепло и 

стать тепло нас показать лишь момент резонно для стайлинга не организовывали без простоя перезапуск 

то есть мы принудить мы красимся контейнера подумаем что надо все поднять занавес собранный на первом это при тестировании 

и прогоняем уже для текущего перемен окружения миграции баз данных которые были написаны разработчикам 

и есть пометка что применять эту топку для лепки мастер

 меня других клеток не выполняю

 если кого заинтересует тело то достаточно набор возможностей 

есть возможность организовать выходки по аптекам



 чтобы дальше то бежать нам нужно установить и дво ран 

это уделяется написано ногам она является личным файлам как принтер либо которые не требуется обретения независимости 

при запуске мы регистрируем соответственно рада 

получаем котлами выгнать из текущих 

потом вызываем командуют лизации командной строке 

и там я вам движение настраиваешь какой доступ мы хотим иметь

 то есть это найджел доступной пир доступ к virtualbox просто настроить чтобы кран заходить дугу машина выполняет команды 

и соответственно он по расписанию будет выполнять пока в слизи колпаками не и выполнять здесь того как камень поступали секретари 



как это визуально выглядит и 2 метра фейсе то есть подключаем deep web site у нас появляется положу которую показывает каком расстоянии находится на отбивные больше момент оценками

 то есть мы видим что вот из 4 минут назад было стенками который прошел все тесты и проблем не выслал 



мы можем более подробно посмотреть по built on здесь мы видим что уже прошли два 

состояния достанет достижение состояния тепло и соответственно уже на стенджер 

если мы кликнем на конкретным одну цель то там будет в консольные который термин процессе прогона команд верну



 вот так вас убить история наш продукт между blue удачные попытки когда тесто подаю соответственно так шаг не переходит на нас мне нравится 



какие задачи мы решали а стельки когда внедрили у нас на 6-м сейчас компонентов и у нас возникла необходимость перезапускать включать компонентов которые были обновлены и при детали и они всю систему целиком

 до этого нам пришлось разнести все по отдельным папочкам

 поставить у нас возникла проблема с тем что докер пуска тупо машин стоит для как бабочки сплаве пространство сети не видит компоненты соседа 

для того чтобы обойти мы создали сеть другие ручную 1к компотик писали что использую для этого проекта такую сеть 

таким образом каждый компонент который стартует с этой сеткой компоненты и часть система 

следующий проблема это разделение стеллинга между несколькими проектами 

так как чтобы все это выглядело красивый максимальную прибрежную production ну хорошо использовать 10 либо 400 порт который использует повсеместно ваня 



как мы решили это назначили один рада всем крупным проектом

 по умолчанию положению ангела позволяет запустить car driving on our который будет просто по очереди в хаотичном порядке из братьев она не прогонять их и возвращать 

что у нас не возникло хаусом и ограничить группу наших проектов одним runner которую принципе крыльями наших объемах кушай справляются без проблем 

создали написала выше или отдельную сеточка виртуального 

подписали его духе compose для что особенно для как раз у жены в спросе который слушай докер мы вынесли его в отдельный скрипт запуска и днем прописали сетки в stem проектов 

то есть у нас проект имеет одно сетку а balancelle имеет несколько сеточек по именам проектов и соответственно он уже может по доменным именем боксировать дальше 

соответственно у нас вопрос приходит по домену 85 дашь разводится уже в группу контейнеров которая будет один домен 



что еще и из проблем которые составе потом это то что по умолчанию все контейнеры выполняют от рута 

то есть это руб неравные рута ucoz системы 

но однако если при коннекте на этих моделях то это бы туру и файл который мы создаем из эту контейнер получают права рута 

соответствии с разработчик прошел контейнер сделал сам какие-то команды которые порождают файлы вышел из контейнера в свое ро ваша виктория он имеет файл который доступ не имеет 

как можно это решить можно добавить пользователи который будет тут же контейнере 

какие проблемы какие сложности на грунтами когда мы давай пользе

 то что с той пользе у нас часто не совпадают они жки они schnucki группы и аниш ники пользователя так называемый ей ней и горения 

чтобы вы решите проблему мы просто говорим что отеля мы будем использовать пользователи с 1000 mah яичников 

в нашем случае это совпал с тем что практически у всех разработчики сайта 

убунта all год 1 пользователям означает песни на идиш если кто ценность 2 пользователя то он сразу проблем которые потребуются на решительно на следующем этапе 



какие у вас планы перечитать документацию по доллару проект активно развивается документация меняется и данные которые были получены два-три месяца назад уже потихоньку устаревают 

часть проблем которые мы решали процессе это 2 место в бангалор уже решены стандартными средствами 

так хочется пройти дальше уже перейти непосредственно к регистрации

 один из примеров это встроенный в докер механизм с вами которые непосредственно представляется из коробки и соответственно запустить что-то продакшене на базе видеть технология пробовать точно какой-то опыт фидбэк соответственно 6 которые знания 

и также порождение контейнеров делать между обусловлен 

потому что у нас сейчас налоги и изолированные они радостных протеин и и достучаться до них не проблема но вызывает некий дискомфорт

 поэтому одна из задач сделать удобный доступ к очередному интерфейса 

тем более системно текущий момент которые этим занимаются существует тех проблем особых не должно составить



 на этом спасибо за внимание

 случае тестирование что насчет запуск по расписанию 

то есть например запустить кучу разноцветных истомина выходные

 то есть я понял вы сейчас запускали только пропускаем по коллеги нас инициатором к метро является непосредственно событие которое правда нет вам пришел к мид vanilla событие отправилась по расписанию соответствие кто-то должен получить сказать про гонимый находят этих команд 

то есть классической схеме использован допустим про дает деревцами контейнер клона не принято использовать те кто слышал в принципе концепции является что toupper даем это какой-то не процесс не какая-то истинно об стопроцентное но желатель стремится домов чтобы один контейнер кричал на какое-то одно действие

 это позволяет далее масштабируется горизонтально 