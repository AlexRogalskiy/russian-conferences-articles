**Здесь переводится видео в статью Ивана Фролкова "Новые возможности выполнения запросов в Postgres 10, 11 & PostgresPro.md"**

Ссылка на видеодоклад https://www.youtube.com/watch?v=nIiqfJDJOSk

**Текст сделан из субтитров. Буду очень благодарен в форматировании текста, его вычитки. Для этого достаточно знать русский язык.
Присылайте свои pull request или присылайте текст на почту patsev.anton[собака]gmail.com**


я фролков его компания по сгрыз профессиональная наша компания занимается разработкой коммерческого варианта под греться ну и соответственно плотно работает с публичной доступной версии как может быть вы знаете новый релиз скажет каждый новый релиз выходит где-то в сентябре октябре и этот год не является исключением соответственно в сентябре-октябре мы ждем новую версию postgres 11 на самом деле я конечно много смотрю что стоит у людей очень много еще люди остался старыми версиями так что даже возможности десятой версии нередко недоиспользуются вот сейчас уже выходит 11 над сказать что особо революционных изменений в ней скажем так есть nordic скорее тектонические то есть где-то внутри и снаружи пока не виден начнем снаружи виде но особо не проявляется соответственно а также изменения пока на первый взгляд в основном эволюционные есть куда расти есть и понятно что не должен дальше будет меняться что будет происходить но на текущий момент я вам расскажу что у нас появилось в 1 ст и карте и то что мы наша компания хочет добавить в нашу версию и что возможно войдет и соответственно в общедоступный вариант итак первое что у нас появился к сожалению я не глядя при применил шаблон который мне прислали представители поэтому я заголовки очень маленькие получились это обнаружил уже довольно поздно обратил внимание вот у нас первая возможность самая такая яркая это jit компиляция теперь можно компилировать запросы не посредством машинный код при подготовке запроса на что он компилируется выполняется где это может быть использована это во-первых ну как я вижу как жука указано в условия веря в также tlist это список колоночка который у нас получается все ли где это агрегаты это выборки из собственно строки projection то есть когда мы не всю строку выбираем определенные колоночки вот то пол ди farming это тоже разбираемся стопам дело в том что в подгрести из организации данных конкретно из-за ну love доступ время доступа к какой-то колонки зависит как ни странно от количества колонка находится перед ней в принципе времени большое если вас колонок меньше тысячи можно этим пренебречь бугай я не знаю есть как больше тысячи колонн очка таблица вот пожалуйста а зачем кстати секрет ну да всякое бывает в общем на самом деле не так страшно я думаю кстати что вы на этом можете хорошо выиграть вот если вас там десять колонн или три то с этого мне особо по крайней мере сапоги фарингит компиляцию выловим особо радости не будет и вот я думаю с вашей вот по полторы . он чека очень будет неплохо когда у какой-то там последний сходить или будет хорошо это все во время компиляции запрос выполняется обращаю внимание nnv вам потребуется старшей версии чем 39 я когда пытался у себя собрать у меня ванильный debian стоит на десктопе соответственно с ним какую тыл вмф apt-get поставил что версия не то пришлось вытаскивать более свежим и с ним соответственно собираться вот но надо сказать что несмотря на обещание громадных возможностей на типовых запросах то есть когда немного колонок какие-то сильно извращенные условия я особого выигрыш не получил да она в принципе быстрее получается но не сказать чтобы радикально дальше меня будет пример где она удивительно радикально быстрее но он немножечко искусственный джут компиляция определяется соответственно определенными переменными их можно выставить можно поставить от листа можете включить jack of cost это у нас насколько рассчитанная стоимость запроса должна быть больше чтобы он включился средствами можно удобнее всего вдоль поставить он всегда будет включаться очень небесное он не будет включаться тут дальше подробности идут я разработчику прикладной я не разработчика собственно subj д поэтому вот например там и важные в опции честно говорим не молчу говорят его завод можно включить можно выключить вот но тем не менее вот такие возможности есть кто-то может быть не интересуется может покупать вот пример когда это хозяйство работает мыло генерирую много строк достаточно бестолков запрос но зато работает показывает по крайней мере вакуум сесть на таблицу анализируем вот у нас выбирается 9 конструктор 9 колонок опять же если на 1 2 это вообще бы не будет чувствоваться больше начиная чувствуется дальше специально выключается про реализация я не еще буду рассказывать пузыри начиная с 10 версии в 11 все более больно любит агрессивно парализует выполнение но тут надо соответственно выключить и соответственно включить жид в любом случае вот соответственно вот такой вот запрос у нас получается с он из afam вообще говоря вот в реальности я в степень ничего не возводил меня больше все как-то суммы какие-то там оборотно-сальдовая ведомость вы подались ну кто вообще занимается и математикой может быть кому-то это актуально например у меня за любимого руководителя у них звездный каталог есть да вот там какого-то безумного размера тоже в общем то задач как ни странно чем странно вот занимается звездам к долгому я как не занимался меня все больше какие-то люди люди до финансы но тем не менее он не степени возводит и получает в общем-то достаточно неплохой результат посмотреть и как раз на выделено сколько выполняется бюджета и сколько с g там вот такой вот запросто обращаем внимание если у вас 2 секунды выполнять и льна я округляю 2 секунд бежит от аджита выполняется за секунду в общем-то два раза быстрее запрос достаточно искусственный на мой взгляд но тем не менее тоже такое бывает соответственно если у вас что-то подобное есть или как у вас полторы тысячи колонок я думаю что на этом можно хорошо выиграть будет смотреть мне правда интересно потому что делать таблицы полторы тысяч колонки я честно скажу поленился вот может быть что-то будет интересно и дальше следующая наболевшая для пузырится тема честно скажу это секционирование она вообще по русски она переводит приводит sconfig цианирование в оригинале называется против milk его по-русски парте цианирования портишь ник называют по-разному ну я все-таки постарайтесь придерживаться нашей родной терминологии насколько она хороша другой вопрос ну по крайне надо быть последовательным и так чем же вы нас всегда была проблема проблема была в том что в 96 и раньше до 96 секционирование на самом деле реализовалась с помощью нас летний таблиц и работал довольно плохо потому что секции можно было отсекать только в том случае если включить экзо не рви задано как литерал даже не как параметры более того она работала с довольно скверно с большим количеством секций то есть там 10 из текста хорошо даже с ветеранами например 2000 секцию же получалось довольно грустно на большем количестве секция можно было налететь на ошибку в десятой версии с виду все улучшилась на самом деле внутри она как была так и осталась просто просто добавился синтаксис должен сказать что наша компания к десятой версии сделала модуль пасман который умел отличать секции разбирать отсекать не нужны как в случае когда ключ позиционируем литералов так если параметрам даже и случае join a по ключу отсекать в агентстве версия ситуация улучшается это не наше это то что предлагает кому на общественное появился первичный ключ к сожалению он появился но как то вот не до конца потому что на него к сожалению френки ими салат с ним я должен входить включить акционер ним в принципе это логично это во всех базах так сделано зато работает он конфликта конфликта апдейтом соответственно и есть триггер и на таблицу все хорошо работает добавили акционер не похож и при обновлении ключа строки могут мигрировать не нужно писать триггер можно сделать секцию по умолчанию туда будут попадать все то что не попадает в нормальной секции должен сказать что у нас в модуле послана есть авто создание секция мне это кажется удобней потому что так у нас в случае ошибки если непонятно куда девать все навалится куда-то в кучу и потом будет долго разбираться может я ошибаюсь может в ряде случаев это хорошо но тем не менее так сделана такая позиция есть отдельный параметр для того чтобы оптимизировать соединение таблиц но он по умолчанию выключено его нужно включать и я в общем то достаточно скептически отношусь к этому ну может я опять же не прав но как-то сомнительно вообще мне не очень нравится как сделан секционирование версии послал откровенно лучше я чуть чуть дальше покажу как она на конкретном примере как она работает ну и соответственно можно создать локальный индус грубо говоря на родительскую таблиц и он автоматически будет создана дочерних таблицах с большим количеством секций оптимизации к сожалению фактически не проводилось то есть если вы хотите 10000 секций на таблицу сделать будет наверное все таки не очень хорошо там начинается проблема уже даже несколько секциями сколько с каталогом потому что для того чтобы что-то выбрать из таблицы на таблицу нас на всю таблицу нужно жить блокировку нужно искать среди множества таблицы возникает в общем с этим лог контента и не очень хорошо у нас позвони это дело оптимизировали тут еще пока не очень я к разработчикам по сп она представлялась там давайте сделавшим можно было 100000 акций иметь вот побольше они старались до 100 тыс это не дотянули но десятичный живет нормально вот обещали и а цитирую из кроме тесто портишь на удалении портится во время выполнения запроса меня тут примера я дальше на него буду ссылаться он состоит из двух таблиц первая таблица у нас с композитным типом езда из двух колоночка пол и род деятельности ну и вторая а и соответственно обращаю внимание что у нас эта композитный тип составить из мужчин водителей и женщин нянечек да вот e-mail e-mail и есть одна женщина водитель дальше там тоже будет в ряде случаев это использоваться ну а вторая таблица вот делается из-за 1 и соответственно функционирует этот жир на выделил последняя строчка беречь на ключ и выделяем чуть чуть выше можно видеть как она по списку секционирование хочу указать хэш довольно честно говоря такой тупенький там остаток отделение берется можно было бы наверное лучше хотя не знаю опять же у нас в паз по воле неволе начинаю к трупу рекламируя просто говорю можно этих зонировать вообще говорю по выражению можете сами выражение указать им будет разбивать по секциями пример как создается секции этой таблице то есть у нас нянечки в одну идут водители в другую секцию идут добавит первичный ключ и соответственно добавляем всех из первой таблице которые с композитным композита колонка добавляет первое вот то последнее интервью как это работает с рефералами смотрим что получилось федералами работает хорошо мы выбираем только ту секцию которая нам нужна вообще красота ну честно говоря ты раньше была игре вышивать не работала с параметрами с параметрами обращаем внимание тоже вполне себе работает вот пример и значит указывая все это дело всё завелось дальше есть такое понятие в подгрести как и нет плана то есть запрос который будет выполнен перед выполнением основного запроса вот обращаю внимание тут которые условия select доллар 3 from weather лимит 1 соответственно это попадает в нет план и тоже работает у меня жирного выделено на языке то есть в общем то все получается нормально хорошо а теперь я в следующем попытаюсь с джой нить соединить у меня всего две секции жирным я выделяю то что к сожалению в данном случае это не работает вот это вообще говоря грустно хотя в реальных в реальной жизни может быть не настолько потому что как-то не попадалось что-либо используется и деньги либо вообще не использует это параметра задают обычно бату секционирования такого такое число и там в общем то и это им оказывается не так критична может быть хотя хотелось бы чтобы работал вообще во всех случаях по крайней мере вот так тоже может быть может быть в ряде случаев кому-то это устроит но опять же это общественная публичная версия доступна всем нужно использовать если у вас секции немного там полсотни предположим почему нет вполне себе право способный вариант для ряд случаев что еще можно сказать про секционирование в общем то это хороший шаг вперед потому что у нас появились триггеры у нас появились первичные ключи скорее все первичные ключи скорее всего наверняка доделаю то что о них можно будет ссылаться это правда здорово но надо уметь и а течение во время выполнения конечно хотелось бы чтобы таблица было гораздо больше секций потому что секционирование с большим количеством мы скажем так группируем однотипные данные рядом это уменьшает вот вывод увеличит производительность очень хотелось бы вот мои соответствие не могу конечно не сказать что у нас все это работает с индексами произошли тоже заметное изменение в 11 версии ну в общем то в данном случае про вставку раньше при прохождении индекса каждый раз один при вставке каждый раз проходился от корня до 300 если мы вставляем предположим первичный ключ у нас по ее of the genie рефбек serial или serial то соответственно была большая драка было тяжело и выбирать сейчас он если вставляется он на всякий случай кешируется в принципе это неплохо поднимает производительность сканирование страницы аж индексов тоже если мы соответственно выбираем несколько значений х у нас предположение уникален раньше у нас каждый раз для каждого значения для хаш яндекса брался multics на страницу конкретно сейчас один раз он берется это вообще в ряде случаев здорово ускоряет производительность наконец хэш эгист и джинны могут работать уровню изоляция сериала и забыл кто нить его использовал сериала izovol а почему так плохо вам не нравится вообще говоря если вы дело мидес обратите внимание пожалуйста уровень изоляции сериала избу вон там шикарные он в общем то такого нет нигде в возрасте есть конечно недостатки но то что дает сериала и забыл он действительно дает посредственно выполнение иллюзию скажем так в отличие от многих других которые даются что-то залечь на по большому счету серверов обратить внимание я кстати практически уверен что если вы его не используете то наверняка очень многих вас возникают ошибки которые вы просто не замечаете в базе смотрите еще раз говорю ладно я отклонился немножечко и появился ход апдейт шаг уход апдейт тоже никто не знает кто значит такой ход апдейт один человек на да как-то вот глядите чем дело что у нас происходит когда мы добавляем туда же добавляем обновляем сроков подгрести у нас при этом обновляется тоже индекса но старые строки не удаляются в яндексе то есть предположим вы добавили еще обновили строчку у нас старая помечена как удаленное новая вставлена вставлена значение в яндекс но старые значение индексов продолжает ссылаться на удаленную строку с тогда вы будем выбираться выбирать по индексу мы получим два возможных варианта у нас пузыри всходит посмотрит а хоть строка удалена и нам ее не покажет если мы обновляем колонку которая не входит в яндекс да в общем-то мы так сильно упрощая можем яндекс и она состоится на той же странице мы можем индекса не трогать и не садисты несколько уменьшить их замусоривание это раньше работало только для индексов которые просто значения колонки но сейчас может это будет в 11 версии работать том случае если это индекс и по функциональная построены под функций от колодки на ведение полезное не могу сказать что она про воду всем очень нужно но в ряде случаев будет конечно хорошо в общем то полезно но без такого дальше кто-нибудь из дуба 2 дело имел один человек имел вы наверное заражу д нет а вот в db2 есть возможность соответственно было бы сейчас есть вставлять колоночки в яндекс который не индексируется вы наверное видели вот но сейчас в 11 версии это появляется в подгрести это дело наша компания это по-моему года три пытались пропихнуть он очень консервативно подогретого и сообщество очень тяжело принимали в принципе там нашли при вы при этом пару багов их поправили значит сейчас можно соответственно индексировать по определенным колонкам плюс в яндекс добавлять другие зачем это надо это на для того чтобы мы при получении данных если он нужно в итоге только эти колодки вот тут первый пример abcd до предложим весь нас запросов использоваться только abcd колоночки мы можем получать из индекса не обращаюсь к таблице вмещает вы вот вывод увеличить производительность в общем-то очень неплохо тут правда стоит вопрос а почему бы их просто не включить в windows без include обезумев не не как отдельные данная прямо там будет ну да какой то там время уйдет на сравнении но не такое большое но тут 2 два возражения есть во первых мы можем сделать уникальным конкретно по двум колонн очкам у него всем четырем это интересное ограничение и второе не такое очевидное у нас вот эти вот дополнительные колонки не обязаны уметь индексироваться по для b3 для больше меньше у нас это могут быть полигоны какие то у нас это могут быть в этом отрезке и координаты и прочие вещи то есть мы координаты больше меньше сравнивать понятное дело не можем они у нас все-таки многомерное тоже должен сказать что второе казалось бы не всем надо то есть кто география не занимается ируини ты не только на самом деле кто занимается чем географическим да никто может оказаться чем-то очень полезная вещь и эта штука есть и в ряде случаев она очень хорошо позволяет ускорить выполнение запросов эта полезная вещь обращай внимание соответственно еще мы теперь умеем делать бипоп bitmap индекс он близко к четкую битва биндекс can кто-нибудь знает понятно ну в общем этот способ доступа к и просто я сейчас буду рассказать это будет очень долго щенков риск из map тоже номер никто не знает человек знает хорошо вообще говоря розыгрыш видео для для таблицы специальный бит bitmap где указывает какая страница занята какая можно писать нельзя писать вот теперь во время вакуума там но при первом проходе новини во втором припер проходит устроить это ускоряет вакуум значит опять же ускорение сканер виды пса можно пропускать на ускорили группками тачку группками знает люди и я сейчас лучше тогда бочку небольшую расскажу есть одна такая не буду говорить какая энни брэда the bass кивала все как положено не транзакционные поэтому чрезвычайно быстро и вот и разработчики а хвалятся что я очень быстро и потом он начал сравнивать с гостями оказалось что после с быстрее почему оказалось быстрее потому что у него у него был честный он пометил давал старался делать все хорошо у него на каждый коммент производил tseng а под колеса заметил группами то есть и мы говорим к вид у нас пол грызть не сразу варим хинкали подождет там несколько миллисекунд вдруг щука подойдет комитету части резака метим сейчас это не выручку ускорили в общем-то тоже поднимать производительность над сказать что подать вообще от версии к версии там поправили здесь поправили здесь поправили производить в общем то так это потихонечку растет тут выросла там выросла то есть если раньше на 95 предположим такое представление было что миллион строк вернуть это примерно секунды сейчас уже два миллиона строк это примерно секунду железо тоже кстати обращали внимания юбки . вот о таких вещах он потихонечку разгоняется значит то теперь папа взгляд вдв умеет больше делать с апдейтом дейтону долину удаленных серверах ускорилось работа с с тостами можно теперь делать размер иван сегмента задавать не при компиляции сервера а при не gibi что такое вал сегментный знает уже хорошо вот дальше вал сегменты хранились раньше sprit последнего чекпоинта сейчас хранятся с последнего чекпоинта это вообще говоря приносили нагруженной базе меньше места уходят подвалы если вы у вас не сильно нагружена базу воскресим вообще ничего не заметить если сильно нагружена база более люди у них к сожалению просто не видно на диске места не было перенести некуда было в общем то иногда это может быть очень важно иногда правда не очень важно появился trunk lid в логической репликация на все более и более такая хорошая становится примером может опрокидывать лишь понимаю зачем ну ладно избы из бекапа можно временные я блоге таблице не вставляется иногда кстати это бывает проблем когда не очень большие он их бы копила не очень удобно чиксулуб потоковые репликации тоже сколько помню мы делали то есть мы обнаружим ошибочки достаточно раньше можно привлекаешь нас от правого позиция промотать над не для разработчиков это больше для админов теперь стал быстро работать добавление наткнулся дефолтом значением она впишется в каталог это в 11 версии можно вакуума на лай сделать несколько таблиц сразу тоже общем-то хорошо и наконец для индексов наверно главное возможность параллельно и построение все время ко мне люди говорили как же так у меня куча ядер почему я не могу параллельно стройке яндексе на самом деле не совсем так и раньше можно было строить cреди create index конкурент ли если у вас нету в принципе можно было правильно строить но сейчас можно строить наконец параллельно индексы в несколько потоков правда естественно вам потребуется хорошие железом вот в вуз первую очередь но я да конечно все это работало то есть если у вас один диск вы навряд ли на этом чуть сильно вы играете если дисков много то уже будет плюс я чуть дальше покажу я всем десктопе это делал это происходило чуть лучше было дальше параллельно что такое hash to join и кто знает он короче говоря теперь когда большие таблицы похожую соединяются стал эффективнее я вот мне каж могу рассказать но принц прохожу это очень долго рассказывать или пары визировал и создание июня в некоторых понятно что например регионал там сложнее про лизе проанализировать чем просто union дальше иногда чрезвычайно эффективная уже не знаю почему раньше не сделали вещь как передачи лимит в параллельных исполнителей это в общем то позволяет быстро оттекать не нужные значения ну вот я у тебя делал как раз эту табличку это у меня на десктопе там один диск 16 гигабайт ну вот он скажем так вадим поток 2 секунды делает в два потока водка обратить внимание alter табл как сделать пролиться разрешить провели за не индексов 18 секунд в принципе логично там таблиц небольшая диск 1 в общем то не понятно с чего им сильного разгоняться если у вас там я der побольше хорошие вот вывод и думаю что можно чем-то все это дело хорошо ускорить ну вот тут например как раз я показываю как работает парализация вы пускаете в одиннадцатом на сказать что он все больше и больше сейчас становится склонен парализация не всегда это хорошо если у вас большой поток одновременных запросов лучше выключить скорее всего есть вас нет нужных запросов потому что на синхронизации между маркерами правильном выполнении тоже требует какие-то ресурсы и это в общем то же может негативно сказаться если если вас запрос скажем так относительно немного не более менее хитрый да вы на этом можете выиграть то есть тут тоже как-то посматривать но у меня вот соединяется две таблицы обратить внимание я добавляю плюс 0 чтобы выключить индекс can и вот первый вариант у нас жжёнов идет в один поток он выполняется есеньке выделил у нас и секунду и три десятых 1373 миллисекунды второй вариант люблю такие вещи так и маленькие швед и самые планы большие все сразу смотрят внимательно вот вот там вот синенькими там бы то крупнее покажу вы ли насколько он выполнялся если вы собираетесь плотно работать под гальцев в общем то пора бы уже привыкать начинать читать параллельные планы дальше их будет больше в час в общем то так то вы чисто чистоты частоты уже особо не растут а за то что я деру увеличивается вот у нас а народ пинает там и 704 6 ядер например машина то есть чем дальше тем больше так что проверь смотреть на таким плана привыкать так что у нас получилось вот у нас это более крупно так сказать более лучше одеваться первая строчка у нас спасительное выполнение 2 параллельно в два потока ну как видите в два потока стал в два раза быстрее ну вот уже в общем-то неплохо было больше ядерным можно было бы еще наверное вряд ли сильно выиграл но тем не менее у играла бы сейчас значит в 11 версии как я уже говорил с научился делать хорошо хоть join с большими таблицами хорошее такое полезное нововведение так у меня тут торопят постарайся покороче улучшить сбор статистики для сильно неравномерных распределений это когда у нас предположим на 2 миллиона строк на у нас одна строчка не попадает то есть как я вам показывал у нас есть мужчина водитель и женщины нянечки одна женщина водитель по закону подлости как раз вот такие неординарные распределения обычно очень часто именно они не нужны они интересуют иногда с этим оптимизатор спотыкался в версии дети сделали статистику по нескольким колонкам честно говоря можно было лучше сделать и я сейчас постараюсь успеть об этом сказать к сожалению сейчас только указывают корреляции между колонками до десятой версии или до текущей версии собирается статистика между колонками то пузырь считал селективность жку селективны знаете таблицы условия очень хорошо вот читал как произведение селективности то есть если у нас однако аллочка 025 предположим 25 процентов выбирала и другая выбирала 25 процентов но перемножать а так как значение запросто могут коррелировать это приводило к серьезную ошибку сейчас корреляцию отслеживает и у нас компании тушку что сделала я надеюсь это у нас попадет значение в нашу версию так дальше сделали оконной функции соответствия стандарту искали 2011 года это к тому что было добавили во-первых группы есть кто оконными функций функция использовал использовали люди вот ручка рожу вот сейчас посмотреться стандарту то есть появились группы вверх-вниз ограничения и можно вот и включ открытка ondraw там и еще ряд ограничений с эксклю там работает то есть можно уже с этим тоже как-то веселиться дальше мелочь но приятно полного текста потому что вы можете т сквере написать неправильно пользователь оседать писать discovery какой-нибудь марево не она он скорее всего напишет не так да не было необъяснимо ревана хоть их грудь нет здесь она будет ругаться все будет виноват и сейчас можно писать вот так вот по английски ну да он по крайней мере вшит попытаться осмыслить этого сделать не ахти какое достижение ну пусть будет то же самое с джонсоном можно полнотекстовый поиск где вот тут же взять случаев полезно не то чтобы тоже смертельно как ну хорошо что есть дальше теперь по моему очень сомнительные нововведение теперь можно управлять транзакциями списку или но не только примерно ним правда для этого надо писать специальные колдун зато вы можете по дороге сказать commit или там марии rollback мне это честно говоря кажется не очень хорошей идеей потому что было как то логичнее в этом плане если вначале функцию то все она странно где выполняется завершилась успешно все нормально завершился ошибка загс откатилась сейчас можно управлять видимо это кому-то было очень надо это пропихнули интересно что был почище с мир джим люди 40-го обычно жалеет а где горит в подгрести мерч кто жил на даже никто не жалел хорошо вот в пузырьки пытались просите в возрасте пытались сделать мир он не слышно попытались сделать мир шон практически прошел его то вставляли то удаляли в конце концов удалили в 11 версии начни попал в принципе понятно почему он и как его рок ли и параллельно выполнение могут давать ошибки он конфликт до апдейт он этого не делает он работает корректно вот вверх с ошибочки у сожалению поэтому его не взяли хотя там большие были проблемы бага бич кто пользовался ну там немножко и ворошили возможности можете обратить внимание вот и в честь добавили дальше такое прочитала до милана композитных тип хан она обиделась бы вот теперь можно делать до милана композитных типов я не знаю для кого это критично вообще говоря логично это было бы ожидать этого не был теперь можно вот я тут пример что у нас предположим и скрипта каринти bitcoin ну и и создающего ограничениями bitcoin 1 8 знаков после запятой если останусь учет и есть то у нас будет проблем у нас не получится такой домен можно сделать песку или теперь наконец можно выходить и едет i quit чтобы народ не путался мне стать не помню как там выходить а control-d выходил сильно а вот теперь еще опция появились вот люди столкнулись с такой проблемой в копия вот больше началась на до в позе xi теперь работает вот такое условие это по стандарту то есть нам степень равна единице чего степени возводится получается и то же самое с единицей как не возводи будет один дальше интересная вещь обращу внимание некоторые слом мозгом это у нас пытаются сделать оптимизацию грубо iv грубой может выполняться двумя способами если вы наверно знаете первое это хэш и второе это сортировкой хэш он выполняется только тогда когда число групп ожидается небольшим в принципе если вы хотите кому-то свалить backend это можно использовать такой хакерский то есть вас выставить такой славе что групп будет очень много пузыри считать будем будете хочу групп мало в аркхем есть небольшой вы в общем то можете и черпать у память такого можно добиться даже мы это делали там отлаживали но тем ни менее обычное обычном не ошибается кстати и если групп немного то у нас идет соединение хорошо если группа много почти все уникальные у нас это сортировкой тут начинаются два варианта сортировкой выполнение у меня тут один затем не очевидны предложен вариант 1 что какие каком порядке ключи стоит в общем неважно в грубой там это указывает казалось бы что если мы сначала по своим более скажем так значение колонку с большим количеством значений это ускорит процесс группировки да это в принципе так если у нас колонки примерно одинаковые у меня тут в примере как можно видеть и выбираются сначала серия а то до 20 и 2 до 200 тысяч то есть вторая колодка у нас более скажем так уникально более длинное соответствие когда мы грубая 12 пишем у нас весь запрос выполнять за 11 секунд когда мы меняем местами у нас запрос выполняется за 15 вот такая штука у нас пытается сделать автоматическую расстановку правильного порядка колонок я честно говоря о нескольких тически настроена эту тему потому что боюсь что угадать не получится но я к чему хочу к чему это привожу пример что если вы будете писать запрос грубая мы сортировкой обратить внимание на порядок грубой может быть переставить будет получше тоже вот интересно почему так происходит потому что у нас колоночки для вот с 2 который получается они длиннее сравниваются дольше вот такая штука дальше это с моей подачи будет такая вещь как оптимизация день из таблицы саму с собой по первичному ключу оказалась бы это очень странная вещь зачем занять таблицу саму событий брюшным причем такое дел о а зачем вы делали дубли по первичному ключу глядите зачем мне это надо было во первых это попадает в рим то что генерит вот но во вторых иногда я сам это делал видеть какая ситуация у нас может быть таблица с сотрудниками там у него есть имя отчество то когда работает когда уволился какие там что и как было подробность дальше у нас может быть в юха представление с подробным описанием человека то его дети сколько он зарплату получал там зарплаты за последние полгода зарплате lizzy ровно за последние полгода начальник там начальник начальника много чего еще он даже большая штука может быть общем-то выписывать июне очень удобно лучшего запихнуть во вью и пользоваться и тут как раз у нас в некотором смысле очень удачно поднимается вопрос о повышении пенсионного возраста если у нас будет бизнес задачи например показать людей которые скоро выйдут на пенсию то например другой месяц назад это были люди которые которого скоро будет 55-60 а сейчас очень может быть что эта функция поменяются за гораздо более хитрый а потом еще раз поменять потому что на моей памяти пенсионная дела году ккк за пятнадцать раз меняли я честно говоря не думаю что они дальше буду бояться соответственно у нас будет достаточно хитрая view которая будет показывать людей которые скоро будут на пенсию разумеется на подробность там не надо нам достаточно первичного ключа ну и соответственно задача вывести хозяин подробности или людей которым скоро на пенсию вполне логично вот написать вот например от просто с джо нить одну одну view с другой по-хорошему получается что мы джойнер таблица само собой по первичному ключу и соответственно наша версия с нашим вот наш оптимизации все это прекрасно вываливает просто доступ у всех сканов данном случае к таблице все очень хорошо работает метод незамысловатая достаточно view было и не стал выписывать и сложные правила которые также стебли к не знаю вот но такая вот штука у нас появилась очень приятно дальше мы пост про будем уметь выставлять параметры в другой сессии передо мной сейчас алексей вертинский выступала про мне только рассказывал это часто возникает задача а что у нас сделает то сайте и посмотреть с модулем off to explain например получили совсем хорошо и можно загрузить соседние цессии попросить стал декстер на лайфстил в силу того что он выполняет это порода выключить можно для всего сервера acana light ставить довольно грустно потому что он здорово нагружает одну сессию можно посмотреть и причем мы там получим не только сколько строк например возвращает запрос а сколько он внутри себя строк обрабатывает что вообще говоря о нигде нигде больше не увидите это очень интересная возможность и очень приятно что это будет функция будет список видов котором поставить но и кусок конфигурации которые нужно и наконец у нас будет еще такая вещь как сбор статистики как я уже говорил для благополучных индексов если у нас индекс по низким колонкам у нас будет уже есть это правда есть не не то чтобы они не то что мы сейчас предлагаем разрабатываем по крайней мере вот и это резко это откуда возникла задача она ну я давно хотел приставал но разработчик которую доделал он налетел на этом на один эти один из очень любит соединять по низким колонку пускать по одной колонке хорошо снят при нормально оценивает количество соединений строп с несколькими колонками у него начинается беда он сильно очень ошибается ему это надоело потому что в конце концов к нему все свалилась потом ко мне частично и вот реализовали что у нас теперь для индекса собирается отдельная статистика и планирую использует собственно говоря у меня на этом наверное все есть у кого какие то вопросы или нет да будьте добры пожалуйста спасибо за доклад продам что понял у меня вот такой русский вопрос мы вот сейчас мы двигались сын со мной и моими этом говорит тебе навыков у нас есть проекта примерно 300 гигабайт весит данные плюс индексы все сидит в памяти у нас все устраивает скорость устраивает чё там у нас обращение в диска минимальное написано что костин и жаловать что как бы им приходится зову как воплотить вот вопрос есть какие-то подводные камни если вот в подписи такую же штуку провернуть чтоб все данные сидели в кэше большого объема душу ну смотря что с ними делать собираетесь внутри 100 гигабайт вообще говоря базу не очень большая вот его мог бы скажем так по опыту миграции 40 la обычно базам начинают работать быстрее и потому что пост глиста настолько лучше oracle а вот опрос потому что дурацкие запросы переписывают пуму исключить если использовать новыми гривка пузыря будет урон то же самое способ поза 6 некая недоверия то есть это как бы все обкатана то есть проекты которые там надо что-то себе все сидят именно в памяти у вас дети есть есть да есть у вас есть вырождение есть водитель до новом подгрузить это выписали не понял в загс и работают на пузырь а загсе у них всё в памяти седина все данные у них по wi-fi не сидит у по крайней мере не на про подводные камни то есть это не то попаду на камеру музами сидит сидит под кажется вообще говорят достаточно безразлично в память не впарить вот он работает интерфейс который предоставляет зимой перед ним и работает все хорошо но и в том плане что здесь работает нормально опять же он говорит если у вас есть весть о рождении загранпаспорт это позволит имейте ввиду ну ладно хорошо пасибо так ну еще в будьте добры два небольших вопросов там один может чуть побольше я правильно понял что jit только с 11 версии до из той был он еще его нет стебли до то есть последний стоял это 10 4 он вообще до 1 ст и вверх еще нет он она будет сентябре-октябре как и говорил хорошо это первый вопрос был второй вопрос а когда появится полноценная первичные ключи в стебле для секционирования таблицах ну и опять увели не раз 12-ой версии не ради какой год начался нас 18 на девятнадцатом году не раньше не раньше осени девятнадцатого года ясно спасибо последний вопрос как вы смотрите на производительность связки postgres и hibernate спасибо знаете больше зависит от разработчиков которые пишут на гибер ники я видел много людей у которых все нормально с этим делом в общем-то не не выделываться все будет хорошо и знать личку или нормально писать например я видел заброс бибер нет с одной таблице было семь left outer join вдунул другой по тому же ключу к одной и той же ну это явно что-то там не так написано ли просто вот если все аккуратно делать получается все достаточно неплохо еще вопросы добрый по сути спасибо за доклад у меня более больше технический вопрос такого плана то есть как сейчас стоит бить его 2 как бы репликация то есть как все жалую здесь 6 что там приходится приделывать слонь или другие какие то вещи ну вам очевидно нужно логической репликации да а чего ноги скрипников достаточно ограничено честно говоря вот особую там что-то сделали но сильные и так вот взято прямо сильные не допиливать а что в общих задач выполняйте но как бы мастер мастер мастер слайд как бы там были вот о чем вас не устраивает обычно по такую в принципе можно как и всегда можно сделать как-то бы вы вернуться когда красивое решение почему бы не воспользоваться знаете например я могу понять когда у нас в москве обычная по регионам раздают какие-то данные причем каждый регион свои должны быть и регион тоже какие-то данные отдает в москву например такую репликацию логическая понимаю вот вас такой сякой случай да фактически у меня такой случай то что как бы очень много легальная региональных bass как бы держать мистик возможно данных как по крайней мере я особо и не пинали логика репликацию да спасибо да будь добр и нет не слышно вас будет и на записи просто что ты и зал и говорят да отвечают спасибо за доклад у меня вопрос а вот вы говорите потом что каким-то образом решается проблема очень неравномерного распределения данных в колонке по статистике a turkish с помощью гистограмм как это в потрусить глядите то что есть ваниль и есть к сожалению только корреляции между колонками то что делаем мы тут как раз последний слайд да у нас будет гистограммы у нас будет common values мужского и так далее короче гистограмм в обычном подписи получается не будет дать так еще будь ну тогда давайте я выйду в коридор и можете меня там а мы вас благодарим за участие за очень интересный доклад и вручаем вам благодарность
