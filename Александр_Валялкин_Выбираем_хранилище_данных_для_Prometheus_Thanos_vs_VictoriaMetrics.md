**[Prometheus](https://github.com/prometheus)** – система мониторинга различных систем и сервисов, с помощью которой системные администраторы могут собирать информацию о текущих параметрах, настраивать хуки для получения иных уведомлений (например, предупреждение, когда возникают какие-либо проблемы).

В докладе будет сравнение [Thanos](https://github.com/thanos-io/thanos) и [VictoriaMetrics](https://github.com/VictoriaMetrics/VictoriaMetrics) - проектов для долгосрочного хранения метрик Prometheus.

![](https://habrastorage.org/webt/vm/ha/hd/vmhahdu2edj4dsc6o3lvzaf-noo.png)

https://www.youtube.com/watch?v=HyOXAdQE0Pk


![](https://habrastorage.org/webt/pg/3x/hc/pg3xhcm_wiipwhdxavyd6e1q8sm.png)

![](https://habrastorage.org/webt/ly/t4/ly/lyt4lyh_ig976fd0yrj_kxgto50.png)

![](https://habrastorage.org/webt/b4/jo/gz/b4jogziezacw5myfzttwx7-c26g.png)

![](https://habrastorage.org/webt/tj/hb/2x/tjhb2xocarftzjxirb0mmdoyy7u.png)

![](https://habrastorage.org/webt/op/ni/ao/opniaodpqcis34bw3f4-twdnsic.png)

Сначала расскажу про prometheus. Prometheus это система мониторинга, которая собирает метрики каких-то target и сохраняет их в local storage. Prometheus умеет записывать метрики в remote storage, умеет собирать алерты и recording rules. 

![](https://habrastorage.org/webt/kg/y1/wf/kgy1wf1db2occcivabh3lqppvw4.png)

![](https://habrastorage.org/webt/ci/iy/l6/ciiyl6uct2oq2r4ngiwcxjo5ksg.png)

![](https://habrastorage.org/webt/ge/8y/xe/ge8yxeqvzh2ov-m5mjgbajdb9zm.png)

![](https://habrastorage.org/webt/dl/ji/yn/dljiynnywlw3fcjl7oc3m7lgstw.png)

### Ограничения Prometheus:

- У него нет global query view. Это когда у вас есть несколько независимых экземпляров prometheus. Они собирают метрики. И вы хотите сделать запрос поверх всех этих метрик, собранных с разных экземпляров prometheus. Prometheus это не позволяет.
- У prometheus производительность ограничено только одним сервером. Prometheus автоматически не может масштабироваться на несколько серверов. Вы только можете вручную разделить ваши target, которые делают scrape между этими prometheus.
- Объем метрик в prometheus ограничен только одним сервером по той же причине что он автоматически не может масштабироваться на несколько серверов.
- В prometheus не так-то просто организовать сохранность данных.

![](https://habrastorage.org/webt/t3/wi/lf/t3wilf2sbn7ndupjqbe1wgxqrzw.png)

### Решения этих проблем/задач?

Решения такие:

- [Thanos](https://github.com/thanos-io/thanos)
- [VictoriaMetrics](https://github.com/VictoriaMetrics/VictoriaMetrics)
- [Uber M3](https://github.com/m3db)
- [Cortex](https://github.com/cortexproject/cortex)

Все эти решения для remote storage prometheus. Они решают проблему remote storage с предыдущего слайда по разному. В данной презентации я расскажу только про первые два решения: [Thanos](https://github.com/thanos-io/thanos) и [VictoriaMetrics](https://github.com/VictoriaMetrics/VictoriaMetrics).

![](https://habrastorage.org/webt/k2/dp/tb/k2dptbckze9plps6m71ycuktv3y.png)

![](https://habrastorage.org/webt/dc/kr/9x/dckr9xddxfufhzctkcfqp6tr3d4.png)

Впервые информация про [Thanos](https://github.com/thanos-io/thanos) появилась по этой ссылке. Там описана архитектура [Thanos](https://github.com/thanos-io/thanos) и как он работает. 

![](https://habrastorage.org/webt/wg/bq/-b/wgbq-b3pwr1emeewan-q5hszprs.png)

Thanos берет данные, которая сохранил prometheus на локальный диск и копируют их в S3 либо в [GCS](https://cloud.google.com/storage/) либов другой object storage.

![](https://habrastorage.org/webt/p7/4g/rj/p74grj159fi9xb58vq-hphcrqyi.png)

Таким образом Thanos обеспечивает global query view. Вы можете запрашивать данные сохраненное в object storage или в S3 c нескольких prometheus.

![](https://habrastorage.org/webt/aj/3u/wi/aj3uwi8dd4wgy-fyogditn--kek.png)

Thanos поддерживает PromQL и prometheus API.

![](https://habrastorage.org/webt/sr/t7/ql/srt7qlyoruhbxr5wglfuyhi9jp4.png)

Thanos использует код prometheus, он использовует storage prometheus и многие части кода переиспользуются Thanos.

![](https://habrastorage.org/webt/3y/ws/ik/3ywsiklzziqimz1aig7uzieblqw.png)

Thanos на самом деле разрабатывает те же разработчики, что и prometheus.

![](https://habrastorage.org/webt/bm/gr/bh/bmgrbh1y5arap-nilpvleilsaei.png)

Про [VictoriaMetrics](https://github.com/VictoriaMetrics/VictoriaMetrics). Вот ссылка где мы впервые рассказали что [VictoriaMetrics](https://github.com/VictoriaMetrics/VictoriaMetrics). VictoriaMetrics - best remote storate for prometheus. 

![](https://habrastorage.org/webt/z9/q2/wv/z9q2wvhshsoqb1ron0jx47djiwc.png)

VictoriaMetrics получает данные с нескольких prometheus по remote write API протоколу, поддерживаемым prometheus.

![](https://habrastorage.org/webt/pl/xl/ad/plxladg1rdvyudc0wzs5oc2ljsa.png)

Также обеспечивает global query view, так как несколько prometheus пишут в VictoriaMetrics. И соответственно вы можете сделать запросы по этомим всем данным. 

![](https://habrastorage.org/webt/9l/cp/aw/9lcpawp68_pq2mrhzya9okprroy.png)

VictoriaMetrics также поддерживает как и Thanos - PromQL и Prometheus querying API.

![](https://habrastorage.org/webt/d1/t1/ek/d1t1ek9rbq_ftlasl48scoriyq0.png)

В отличие от Thanos, исходный код VictoriaMetrics написан с нуля и оптимизирован по скорости и потребляемым ресурсам. 

![](https://habrastorage.org/webt/ps/t6/gu/pst6guuoseu2dicx9tra1bvjhry.png)

VictoriaMetrics в отличие от Thanos масштабируется как вертикально так и горизонтально. То есть Single-node верстия, которая масштабируется вертикально. Вы можете начать с одного процессора и 1 ГБ памяти и постепенно расти до 100 процессоров и 1ТБ памяти. VictoriaMetrics умеет использовать все эти ресурсы. Ее производительность вырастет примерно в 100 раз по сравнению с 1-ядерной системой. 

![](https://habrastorage.org/webt/tb/s7/t4/tbs7t4unnruaytt7duwambgofne.png)

История Thanos началась в ноябре 2017 года, когда появился первый публичный коммит. До этого Thanos разрабатывался внутри компании [improbable.io](https://improbable.io). 

![](https://habrastorage.org/webt/ik/g7/dg/ikg7dgnmbyiph40zo7v7kyhxrdy.png)

В июне 2019 года был знаковый релиз 0.5.0, в котором убрали [gossip](https://en.wikipedia.org/wiki/Gossip_protocol) протокол. Eго убрали из Thanos, потому что он себя показал не с лучшей стороны. Часто кластер Thanos неправильно работал, неправильно подключались к нему ноды из-за [gossip](https://en.wikipedia.org/wiki/Gossip_protocol) протокола. Поэтому решили его оттуда убрать. Я считаю что правильно сделали. 

![](https://habrastorage.org/webt/5y/bu/cu/5ybucuovkh85tqwsrv3cjre-zmu.png)

В том же июне 2019 года они отправили проползал в [Cloud Native Computing Foundation](https://www.cncf.io/).

![](https://habrastorage.org/webt/16/rz/x_/16rzx_bswddquoqw4cmw9txobxa.png)

И через пару месяцев Thanos приняли в [Cloud Native Computing Foundation](https://www.cncf.io/), в которую входит Kubernetes и другие популярное проекты.

![](https://habrastorage.org/webt/9c/i2/ic/9ci2ictg_n0xtgdcxtklghw4n2w.png)

В январе 2018 года началась разработка VictoriaMetrics.

![](https://habrastorage.org/webt/wi/li/co/wiliconuw5mwhyzizzthqk8a2og.png)

В сентябре 2018 я впервые публично упомянул про VictoriaMetrics.

![](https://habrastorage.org/webt/gd/th/ka/gdthkaxubi8jzg8gedilcotjdje.png)

В декабре 2018 года опубликовали Single-node версию.

![](https://habrastorage.org/webt/ui/r7/23/uir723wmd-l1dwxds6katr8cfco.png)

В мае 2019 были опубликованы исходники как Single-node, так и кластерной версии. 

![](https://habrastorage.org/webt/a7/tk/ug/a7tkughz1ut9dmlfb6ued1irbh8.png)

В июне 2019 также как Thanos, мы подали заявку CNCF foundation под номером 255. Мы подали заявку на один день раньше чем подал заявку Thanos. 

![](https://habrastorage.org/webt/pk/dm/zr/pkdmzr2xn880osldinx6sb10-ai.png)

Но, к сожалению, нас до сих пор не приняли туда. Нужна помощь коммьюнити.

![](https://habrastorage.org/webt/mw/2w/we/mw2wwenfu8tecrrkyrkx-8dhf-8.png)

Мы рассмотрим самые главные слайды про архитектуру Thanos и VictoriaMetrics.

![](https://habrastorage.org/webt/1w/by/96/1wby96ev7cqhx7-psbem1b-bf-i.png)

Начнем с Thanos. Желтые компоненты - это компоненты prometheus. Все остальное это компоненты Thanos. Начнем с самого главного компонента. Thanos side-car - это компонент, который устанавливается рядом с каждым prometheus. Он занимается тем, что загружает данные prometheus локального storage в S3. 

Есть еще такой компонент как Thanos Store Gateway, который умеет считывать эти данные c Cloud storage динамически на входящие запросы от Thanos query. Thanos query - компонент реализует promQL и prometheus API. То есть снаружи он выглядит как prometheus. Принимает запрос promql, отправляет его в Thanos Store Gateway, Thanos Store Gateway достает нужные данные из Object Storage S3, отправляет их назад.

Но у нас в Object Storage хранятся данные без последний двух часов из-за особенности реализации Thanos side-car, который не может закачать последние два часа в Object Storage S3, так как это два часа еще prometheus не создал из них файловы в локальном Object Storage.

Как же это решили обойти? Thanos query кроме запростов в Thanos Store Gateway отправляет параллельно запросы еще в каждые Thanos side-car, которые находятся рядом с prometheus. 

А Thanos side-car свою очередь проксирует этот запрос дальше в Thanos side-car и достает данные за последние два часа.

Кроме этих компонент, есть еще опциональный компонент, без которого Thanos будет плохо себя чувствовать. Это Thanos Compact, который занимается слиянием мелких файлов на Object Storage в более крупные файлы, которые были загружены отсюда с Thanos side-car. Thanos side-car выгружает туда файлы размером стандартного два часа. 

Эти файлы, если их не сливать более крупные файлы, то их количество может вырастить очень существенно. Чем больше таких файлов, тем больше нужно памяти для Thanos Store Gateway, тем больше нужно ресурсов для передачи данных по сети, метаданных. Работа Thanos Store Gateway становится неэффективной. Поэтому нужно обязательно запускать Thanos Compact, который сливает мелкие файлы в более крупные, чтобы таких файлов был меньше и чтобы уменьшить overhead на Thanos Store Gateway.

Есть еще такой компонент как Thanos Rule. Он выполняет prometheus-е rule для alert и может вычислять prometheus-е rule для того чтобы записывать данные снова в Object Storage. И этот компонент Thanos Rule можно использовать не только с Thanos, так как он универсальной, то можно использовать и с VictoriaMetrics.

Вот такая схема простая. 

![](https://habrastorage.org/webt/os/em/y4/osemy4ys_bkpy-ngxj7jg-gdmom.png)



Теперь сравним со схемой VictoriaMetrics.

У VictoriaMetrics есть 2 версии: Single-node и кластерная версия. Single-node работает на одном компьютере. В Single-node нет этих компонентов, просто один бинарник. Этот бинарник на слайде выглядит вот этим квадратом. Все что внутри находится это содержимое бинарного файла для Single-node версии. Вам необязательно про него знать. Просто запускаете бинарник и все у нас работает. 

Кластерная версия сложнее. Внутри нее находится три разных компонента: select, insert и storage. Из названия должно быть понятно чем каждый занимается. Insert компонент принимает данные в разных форматах: из prometheus remote write API, inluxe протокола, graphite протокола и из opentsdb протокола. Insert компонент принимает их, парсит и распределяет между имеющимися storage компонентами, где данные уже сохраняется. Select компонент в свою очередь принимает promql запросы. Он реализует promql и также prometheus API, может быть использован как замена prometheus в Grafana или других prometheus API клиентах. Select принимает promql запрос, парсит его, считывает необходимые данные для выполнение этого запроса из storage нод, процессит эти данные и возвращает ответ.

![](https://habrastorage.org/webt/sb/co/mx/sbcomx2usdrwzbyfgqjubvoichg.png)

Основная основные слайды прошли. 

Сравним сложность установки Thanos и VictoriaMetrics.

![](https://habrastorage.org/webt/hv/gw/r6/hvgwr6nk7yh4nog7rpjac4fn0se.png)

Начнем с Thanos. Перед тем, как начать работать с Thanos нужно создать storage bucket в Object Storage так как S3 или GCS. Чтобы Thanos могу туда данные записывать. 

![](https://habrastorage.org/webt/st/hk/5s/sthk5swss1mkaalb4p3oiebnesq.png)

Потом для каждого Thanos что нужно установить Thanos Sidecar. Но перед этим не забыть отключить data compaction в prometheus. Data compaction похожий компонент Thanos Compact в prometheus, который сжимает данные в Object Storage для того чтобы меньше потреблять ресурсов. Похожий компонент есть в prometheus. Он тоже самое делает с данными, которые пишутся в локальный storage, который периодически сливаются более крупные данные, чтобы уменьшить накладные расходы.

Когда вы устанавливаете Thanos Sidecar к вашим prometheus, вы должны отключить этот data compaction, потому что Thanos Sidecar не умеет нормально работать, когда включен у prometheus data compaction. Это означает что ваш prometheus начинает сохранять данные блоками по два часа и перестает сливать в более крупные блоки. Соответственно, если вы делаете запросы, которые превышают длительность последние два часа, то они будут не настолько эффективно работать, по сравнению с тем как могли бы работать. этот был включен data compaction.

![](https://habrastorage.org/webt/gd/as/pw/gdaspwys_r63cegoxqovl9bcmie.png)

Поэтому Thanos рекомендует уменьшать data retention в локальном storage до 6-8 часов, чтобы снизить этот overhead большого количества мелких блоков.

После того как вы установили Thanos Sidecar, вы должны для каждого Object Storage Bucket установить два компонента. Это Thanos Compactor и Thanos Store Gateway. 

![](https://habrastorage.org/webt/cw/4f/yk/cw4fyksvnkmp1tcn-clf-2gzx3q.png)

После этого установите Thanos query и настроить его чтобы он умел подключаться ко всем Thanos Store Gateway, который у вас есть, и также умел подключатся ко всем Thanos Sidecar.

Тут может быть небольшая проблемка. 

![](https://habrastorage.org/webt/vf/sc/30/vfsc30z00pvcnupbdym2jztx09k.png)

Вам нужно настроить надежно и защищенное подключение от этих компонентов. И если у вас prometheus находится в разных дата-центрах, либо в разных VPC, то к ним запрещены подключения из вне. Но для работы Thanos query вам нужно как-то настроить подключение туда и вы должны придумать способ.

Если у вас таких дата-центров много, то соответственно снижается надежность всей системы. Так как Thanos query должен постоянно держать подключения ко всем Thanos Sidecar, расположеных в разных дата-центрах. При каждом входящем запросе он будет направлять запросы на Thanos Sidecar. Если соединение прервется, то вы получите либо не полный набор данных, либо получите ответ кластер не работает. 

![](https://habrastorage.org/webt/rb/ka/aw/rbkaawevhardp1d85mhgdejylxg.png)

В VictoriaMetrics немного все проще. В Single-node версии достаточно просто запустить один бинарник и все работает. 

![](https://habrastorage.org/webt/co/ui/ll/couillafhtmobnbutejgs6qvszu.png)

В кластерной на версии достаточно запустить все вышеупомянутые три типа компонентов в любом необходимом вам количестве, либо использовать helm chart для автоматизации запуска компонентов в Kubernetes. Мы еще планируем сделать Kubernetes оператор. Helm chart не покрывает некоторые кейсы и позволяет вам выстрелить ногу. Например, он позволяет уменьшить количество storage node, что приведет к потере данных.

![](https://habrastorage.org/webt/jb/ta/0t/jbta0t7qcko6jov_x1ximqkfni0.png)

После того как вы запустили один бинарник либо кластерную на версию, вам достаточно добавить в конфиг prometheus remote write url чтобы он начал записывать даннык параллельно в локальный storage и в remote storage. Как вы заметили эта настройка должна работать на много надежнее по сравнению с настройкой Thanos. Нам не нужно держать подключение от VictoriaMetrics к prometheus, например от большого количества prometheus в разных дата-центрах, потому что prometheus сами подключаются в VictoriaMetrics. 

![](https://habrastorage.org/webt/u3/3a/if/u33aifuu7myx3vvs0mkbeysfnei.png)

Рассмотрим сопровождение Thanos и VictoriaMetrics.

![](https://habrastorage.org/webt/fq/dt/d2/fqdtd27cjx-yktnyozgxoon2pte.png)

У Thanos нужно следить за Sidecar чтобы они не прекращали загрузку данных в Object Storage. Они могут прекратить эту загрузку данных в вследствие ошибок загрузки, например у вас временно прервалась сетевое соединение с Object Storage, либо Object Storage временно стал недоступен. Thanos Sidecar в этот момент заметит это, сообщит об ошибке, может свалиться и после этого перестать работать. Если вы не будете мониторить, то у вас перестанут передаваться данные в Object Storage. Если пройдет время retention (6-8 часов рекомендованное), то вы будете терять данные, которой не попали в Object Storage.

![](https://habrastorage.org/webt/z7/bm/cx/z7bmcxgwyscnrnnehhtjvuqipho.png)

Thanos сompactor-ы могут перестать работать из-за race-ов (ошибок) с Sidecar. Сompactor-ы берут данные с Object Storage и сливают их в более крупные куски данных. Так как сompactor-ы не синхронизированы с Sidecar-и, то может произойти что Sidecar не успел еще дописать блок, сompactor решает что этот блок полностью записан. Compactor начинает его считывать. Он считывает блок не в полном виде и перестает работать.

![](https://habrastorage.org/webt/_u/c6/hb/_uc6hbgr_kl9l2an5yl0cs9hfba.png)

Store Gateway могут отдавать неконсистентная данные из-за рейсов между сompactor-и sidecar-и. Тут такая же штука, потому что Store Gateway никак не синхронизирован с сompactor-и sidecar-и. Соответственно могут возникать рейсы, когда Store Gateway не видит часть данных, либо видит слишком много данных лишних. 

![](https://habrastorage.org/webt/-y/20/ur/-y20urze7qgwxkrklj8ave_ct3i.png)

Query компонент в Thanos по умолчанию отдает частичный результат, если некоторые sidecar-ы либо Store Gateway не доступны в данный момент. Вы получите часть данных или даже не будет знать что вы получили не все данные. Это он работает так по умолчанию. В похожей ситуации VictoriaMetrics возвращает помеченные данные как частичные. 

![](https://habrastorage.org/webt/2g/op/wp/2gopwpbh41vviugdebarsjuql4w.png)

В отличие от Thanos VictoriaMetrics редко теряет данные, даже если прервалось подключение от prometheus к VictoriaMetrics, то не проблема, так как prometheus продолжается записывать поступающие новые данные в Write Ahead Log, размер которого равен 2 часам. Если вы в течении двух часов восстановите подключение к VictoriaMetrics, то данные не потеряются. Prometheus умеет данные, которые были не записаны, записать после восстановления подключения к VictoriaMetrics.

![](https://habrastorage.org/webt/kg/nl/mv/kgnlmvkqxfagsjhodoybpwzl7am.png)

в отличие от ануса которые записывают только данные спустя два часа два часа тонах не записывать в экстре виктория про митоз реплицирует автоматически данные по ремонту рать протоколу в ремонт соответственно виктор метрик и вам не страшна по периметру параметров потерял его которой что вы лучшем случае потеряете там парусе последних секунд данных тройник или в отличие от то на среди вы потеряете два счета да

![](https://habrastorage.org/webt/ba/xj/90/baxj90beqmojti9xkubodbkbvdw.png)

 ну и бернес автоматически управляет постеров сложно настроиться его выбирать все поместить в один cabernet фактор это можно сделать например нас мастеров по одному костерок квартиру на каждый prometheus со styko рам и один кластер даже в котором будет 

торге play квари компоненты компактор а то есть намного сложнее тем предметом без поста примерно с мастером будет работать 

![](https://habrastorage.org/webt/gz/lb/6l/gzlb6lg2dkrabcovqcohvovd-mk.png)

электрометрии очень простое обновление на новой версии просто берете перезапускает бинарники меняется робина региона в старой бинарники искать новые при остановке через feeding сигнал все бинарники примет rex белых угрей с push up down у пирса не там правильно сохраняет нужны данные виды вы закрывать входящее соединение чтобы ее не потерять и поэтому вы ничего не прядь при обновлении 

![](https://habrastorage.org/webt/qz/yf/8c/qzyf8cvpqlimwabno0zx7v5_rxw.png)

и виктор метрик очень просто расширять фактор просто добавляется необходимо компонента когда необходимо продолжать рабов 

![](https://habrastorage.org/webt/hl/le/sj/hllesjwiv-f1wosgssd7wp6aclo.png)

подводные камни и там и там 

![](https://habrastorage.org/webt/xs/ec/b0/xsecb0yy15vimtsl9k9quqplyiw.png)

подводные камни и что я уже рассказывал что примет изложен хранить данные последние два чисто если они потеряют соответственно полностью потерять что они еще не . 3 

![](https://habrastorage.org/webt/fg/xo/yo/fgxoyo1q8mihcdy7m_yyio_pyum.png)

итоге твоей компоненты и компактор компонент может требовать много памяти для работы с большими воды storage bag там если там хранится много файлов мелких приговорил чем больше количество файлов тем больше требуется оперативной памяти других фейкам фактор для хранения миллиметра информацию найти еще танос и почитать и еще по поводу того что танцы гитаре и фактор падают при средних объемов записанного данных будут очень много пони 

![](https://habrastorage.org/webt/-n/k3/rg/-nk3rgph8ghszyegz1j8jx89bio.png)

и такая штука вот там-то нас рекламирует что он может перец бесконечно на количество ваших заметил в производительности или фонтан деле это неправда так как все запросы идут через твари компонент который должен у параллельно просить торге твои компонента и все-то насыпят компоненты вытянута туда данные об атомах там про процессе и очевидно что скорость запросов ограничено самым медленным ладно стал медленным только своим либо стал медленно 

данный сектор и эти компоненты могут неравномерном нагружены например вас есть про видео с которым там собирают миллионы метров секунду где странице сказал собирается тысячами других взрыва пронизав миллиона собирают на три секунды он загружен намного сильнее загружает комплектом он работает соответственно там на сайт картам медленнее работает и вообще за 

медленно работает и software компонент будет очень медленно оттуда данная вытягивает большой объем данных по стране другим там где там записывать соответственно вас на производительность вашего всего poster а то нос будет ограничен этому медленным тону фактором

![](https://habrastorage.org/webt/mg/an/ra/mganracsmhkyz1_1aq014v_6cfc.png)

 и я уже про это упоминал по умолчанию то нас дает частичное давно если некоторые факторы и либо только твои недоступное доступным должны уже были понять предыдущих слайдах если у вас останутся коробки данная по всему миру разных оттенков то вероятность разрыва соединение недоступности некоторый компонент сильно возрастает и соответственно большинстве случаев будет получать частичная данная даже не зная об этом

![](https://habrastorage.org/webt/1t/m2/j7/1tm2j75o5cpscbevahbz4m0wusk.png)

 инструменте кто-то из подводная кому первый подобный камень этого опция который ограничивает объём оперативной памяти используем под крыши инструмент по умолчанию на равна 60 процентов оперативной памяти на машине где виктор метрик запущена либо на кибернет пользуясь периметре да . и если неправильно поменять это значение то можно угробить производительность которых например искусное 

слишком низкое значение то данная перед могут перестать помещаться cash back the remixes за это ей придется делать лишнюю работу и соответственно же награждать или на процесс старый диск если вы сделать и отток слишком большой потом себе моста сто процентов то это повышает во-первых вероятность того что в периметре будет вылетать out of memory и во-вторых это будет приводить толсто операционки семья будет оставаться очень мало памяти оперативной памяти для файлового кэша а victory метрика очень сильно полагается на файл окажется для 

производительности файла каша пиратов если его недостаточно то соответственно будет замок дурости сильно нагрузка на диск шпинне запись поэтому совет не менять параметры если бы стране необходимо

![](https://habrastorage.org/webt/3q/eo/25/3qeo25x5juqpyquhllrhpt9eh34.png)

 2 pc to retouch на период которые по умолчанию выставлен 1 месяц время в течение которого кормили сохранить данные после этого эти данные эфир она удаляет многие допускают 

периметр и без этого параметры и записывал до нас еще и месяца вот он счастлив а чего они пропали в этом за предыдущий метод потому что рита решим по умолчанию в месяц обязательно знать и устанавливать правильно рычащим 

![](https://habrastorage.org/webt/n1/5a/jm/n15ajmeqozq7zfzc0uv3imzfebw.png)

пройдет по уникальных и чем

![](https://habrastorage.org/webt/k8/b7/br/k8b7brhqxwy1fa1vdurx0yolgra.png)

 у то нас есть такая фича как далсим пятиминутное часовые интервалы которые зачастую не правильно работает если погуглить посмотреть еще с на гитаре что там очень много еще 20 просто что он иногда неправильно работает либо не работать не так как ожидают пользователь

![](https://habrastorage.org/webt/iv/nq/4v/ivnq4vtxkkwf_1hs40ttkyhd1ie.png)

 это на срезе дупликация данных для прометей 2 prometheus а собирают одни и те же метрики паразитов и складывают их товарищ там сумеет правильно ли дублировать эти данные в отличие от виктории утонувшие 

![](https://habrastorage.org/webt/wn/rv/jh/wnrvjhzqrcx6_o9hoojijeivb8o.png)

соли alert компонент про который был разностями но этот же allure компонент подходит директорий metrics можете использовать 

![](https://habrastorage.org/webt/ti/qp/ci/tiqpcidg_t_ahj9lornrey8_rda.png)

и данное преимущество что общий код танос и promises разработана 9 разработчиками и соответственно при улучшениях лигов нанося либо фармить выигрывает подписано другая страна проведет либо там ну и 

![](https://habrastorage.org/webt/en/vo/o-/envoo-2amya3w4xo2c5lg-pa1bo.png)

керамика главная только там выбран пел расширенный промывка то про который рассказывал в предыдущем big money feat метаться

![](https://habrastorage.org/webt/yk/xq/hi/ykxqhipgapygdv7ra2c6rmaitnk.png)

 victory метр x поддерживает заливку данных по множеству разных протоколов не только может принимать данные от правительства мной купаться hdd и графита этим протоколом о климате система спартакова и 

![](https://habrastorage.org/webt/0k/zy/jp/0kzyjptb5sbscny1ffsdh2irqau.png)

данные витер метрик занимаются обычные намного меньше места последний установкам правительством и не версии плотин толково брайана то правильно brazil от последнего прав он одел всего что данная занимает одинаковое место в правительстве что ethernet и потому что он записывал рандомное данная которая в реальных системах мониторинга редко встречаются и такие рандомное данные они вообще не сжимаются поэтому соответственно итер metrics и не смогла и сжать и как и правительстве и соответственно получились одинаковые 

результаты если записать реальные данные в пользователи говорят о двукратном 3 равно пятикратном уменьшение размера данных на диске patroned пронесется и соответственно танцы пользуется пронесет 

![](https://habrastorage.org/webt/2y/xz/yg/2yxzygpbfnqt3ldibpggeo35rpw.png)

но и еще одно преимущество и периметре что она презирала повторы 

![](https://habrastorage.org/webt/kk/jd/hy/kkjdhy-zae6bc_3uqu6yp3q1gwy.png)

про стоимость инфраструктуры пройдемся 

![](https://habrastorage.org/webt/79/yz/yw/79yzywujo1uxm6zc5rti6ebjzpq.png)

отдать преимущество носа что он сохраняет данный объект врач который сравнительно дешевой я заказал что стоимость приблизительно 20 доллара за терабайт в месяц принять в быстродействующего выставочно можно также стране данное более-менее быстродействующая сторож которые более дешевых но соответственно от этого может 

пострадать ваш производительность ваших запросов на постере томаса предстояние данных уже сто раз так же вы должны оплачивать операции такие как запись и чтение данных 10 доллара за миллион операции приблизительно и передачи данных когда вы записываете данные штанов вы оплачиваете соответственно расходы вашего охотника на оплот api данных в интернет если это на шпатель находится не там и когда учитывается данная бедра и откуда-либо мадонна захватом вы оплачиваете от 10 до 230 долларов завтра based on и дома и это может быть существенно . если вы запрашиваете исторические данные танов кластера

![](https://habrastorage.org/webt/eg/--/mv/eg--mv_wpjcv4m-tojp8l9r60ea.png)

 также для the last снова нужно оплачивать сервера для компактор оскорбит фейковой компонент который требует много памяти цепью для больших объемов данных



![](https://habrastorage.org/webt/pz/0v/np/pz0vnpflfebkxmaqi3sbbucktz0.png)

да parametric с прохода такие  если хранить данные в степи диска упал дисков то не стоит сорок долларов за заработка от обычной одесской интер метре достаточно обычная жизнь дисков не нужны никакие который раз пять дороже что она оптимизирована подожди здесь

![](https://habrastorage.org/webt/dr/6q/lz/dr6qlzowqew8et2zpev1wkrq4cs.png)

и соответственно для виктора метрики нужно сервера для компонент либо персик либо квартирный компонент который в отличие от танков компонент требует намного меньше грамм соответственно не будет дешевле 

![](https://habrastorage.org/webt/ja/72/cr/ja72crhogqpdixrt8jzj-komdcq.png)

пример внедрения рассмотрим 

![](https://habrastorage.org/webt/od/ji/fw/odjifwunkpjdwuqq-hbpwswu_cy.png)

это наша главная премьера внедрение to get love но там полностью работает на то нас но там не все так гладко если посмотреть поищи там поискать оба все еще открыты можете зайти с ним приапа это еще и посчитать что у них постоянно возникают какие-то операционные проблемы станут вам не хватает памяти для строки кого-либо квари компонент они постоянно там приходится им увеличивается объем памяти 

соответственно вещества и расходы на это постоянно какие то проблемы но неё не очень успешное внедрение досказал и второе внедрение которое может быть более успешно это компанией пробовал которые начали разработала танос и они опубликовали sonic и его и там после этого отказаться от этой компании и пробовал компания занимается разработкой движков для игровых 

игровых движков и похоже они там где-то может быть нормально используется она моя неуверенность обратно на 100 конечно еще куча других примеров внедрения я точно не знаю даже

![](https://habrastorage.org/webt/t4/yh/y4/t4yhy4gyfrimyzyfopgdwk1ixyc.png)

который метрик публичные примеры внедрения это wix.com конструктор сайтов слышали adidas внедряет историк и даже сделал доклад на последнем пром коне и надеюсь что скоро опубликую 

слайды видео нормально потому что то что видео не записали на какой-то там не очень качественная трафик stars компания это одна нам cz какой то поисковик популярные чешские а дальше пошли ноунейм компании которых нет ни новой компании эта компания который я не могу 

назвать сейчас не дали согласие на это есть один крупный разработчики игр крупнее чем им пробовал пасторское крупно разработчики графического крупный российский банк а потом может клара твой сын дагестане кредит если еще производитель ветряных турбин европейский который успешно протестировал victrix сейчас уже внедряет для мониторинга данных полученных ветряных 

турбин то скорость этом писал сэмплов секунды на каждый датчик кабинетом понятен даче у них там 3 или 5 8 ветераны хирурги и они довольно интернет работает и что не может быть ни одна пройти против не знаю что крупная это я просто в этом слабо разбираюсь просто может быть и 

крупных может быть двести-триста другими нарисовать пару сотен турбина то ветряных не знаю круг мел и если еще у нас российские авиалинии которые хотят внедрить виктор и метрика 17 никак не могут поднимем остались договор 

![](https://habrastorage.org/webt/lw/0f/r3/lw0fr3hdyce3yw6n0i3ywjnpxhs.png)

выводы такие что victory metrics это нас решают похожие задачи но по разным способам это глубокое view масштабирование горизонтальная и произвольно решил

![](https://habrastorage.org/webt/pv/-b/ob/pv-bobndxjkjrcukph5xm3sa-98.png)

 спасибо







![](https://habrastorage.org/webt/gu/0s/w5/gu0sw56ppge1icdy-ensv-wl3f4.png)
